<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>{% block title %}校内質問受付システム{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('school_qna.static', filename='css/style.css') }}">
    <style>
        :root {
            --primary-color: {{ theme_color }};
        }
    </style>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    {% block styles %}{% endblock %}
</head>
<body data-url-prefix="/qna">
    <header class="app-header">
        <div style="display: flex; align-items: center;">
            <button id="sidebar-toggle" style="background:none; border:none; color:white; font-size:1.5em; cursor:pointer; margin-right:15px;">☰</button>
            <h1>校内質問受付システム</h1>
        </div>
        <div id="realtime-clock" class="clock-display">読み込み中...</div>
        <nav class="main-nav">
            <span class="nav-separator">|</span>
            <a href="{{ url_for('school_qna.index') }}">新規受付</a>
            <span class="nav-separator">|</span>
            {% if session.logged_in %}
                <a href="{{ url_for('school_qna.list_view') }}" id="nav-list-link">質問一覧</a>
                <span class="nav-separator">|</span>
                <a href="{{ url_for('school_qna.change_password_prompt_current') }}">パスワード変更</a>
                <span class="nav-separator">|</span>
                <a href="{{ url_for('school_qna.logout') }}">ログアウト</a>
            {% else %}
                <a href="{{ url_for('school_qna.list_view') }}" id="nav-list-link">コーチ用画面</a>
            {% endif %}
        </nav>
    </header>
    <hr>
    <script>
        // VSCodeのエラー回避のため、JSON.parseを使って文字列として受け取る形に変更
        window.isUserLoggedIn = JSON.parse('{{ is_logged_in|default(False)|tojson }}');
    </script>
    <main class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div style="padding: 10px 0;">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
    <footer>
        <hr>
        <p>&copy; Codeswitcher Co.,Ltd. All rights reserved.</p>
    </footer>

    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>自習室業務支援システム</h2>
            <button id="sidebar-close" class="sidebar-close">×</button>
        </div>
        
        <div class="sidebar-status-card">
            <div class="status-item">
                <span class="status-label">現在のモード:</span>
                <span class="status-value mode-badge" id="sidebar-mode-display">質問受付</span>
            </div>
            <div class="status-item">
                <span class="status-label">ネットワーク:</span>
                <span class="status-value" id="sidebar-network-status"><span class="status-dot"></span> <span id="network-text">判定中</span></span>
            </div>
            <div class="status-item">
                <span class="status-label">サーバー通信:</span>
                <span class="status-value" id="sidebar-server-status">待機中</span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="/">入退室管理システム</a>
                    <ul class="sidebar-sub-nav" style="margin-left: 15px; font-size: 0.85em; opacity: 0.8;">
                        <li><a href="/?mode=students" style="color: #666;">通常モード (生徒用)</a></li>
                        <li><a href="/?mode=scanner" style="color: #666;">スキャナーモード</a></li>
                        <li><a href="/?mode=admin" style="color: #666;">管理者モード</a></li>
                    </ul>
                </li>
                <li><a href="{{ url_for('school_qna.index') }}" class="active">質問管理システム</a></li>
            </ul>
        </nav>

        <div class="sidebar-actions">
            <button id="open-settings-btn" class="sidebar-action-btn">⚙ システム設定</button>
        </div>

        <div class="sidebar-footer">
            <p>Version 1.1.0</p>
            <p>&copy; 2026 Codeswitcher Co.,Ltd.</p>
        </div>
    </aside>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <script src="{{ url_for('school_qna.static', filename='js/script.js') }}"></script>
    {% block page_specific_scripts %}{% endblock %} 
</body>
</html>